ðŸ“„ docs/v4.5-QA.md

ChatLaLiLuLeLo v4.5 â€“ QA / Security / Performance Burst

Objective

Before adding new features, consolidate v4 with a QA-driven sprint. Focus: CI robustness, unit testing, security hardening, and performance verification.

Scope
1. CI Enhancements

âœ… Extend GitHub Actions to include:

Unit tests (Jest/RTL for key components).

Mock Worker tests with supertest/miniflare.

Lint + typecheck already in place â€” keep as baseline.

âœ… Add a separate job for security scans:

npm audit --production

npx eslint --max-warnings=0

âœ… Performance budget check: fail if bundle > target size (e.g., 3MB gzipped).

2. Unit & Integration Testing

Frontend:

Test SubtitleStream for newline wrapping, word-buffer streaming.

Test ModelToggle toggles model & persists in localStorage.

Test Mode-tagged replies render [JD]:, [BTC]: etc.

Backend:

Mock OpenAI responses â†’ verify streaming handler logic.

Rate limiting: hitting cap yields friendly error JSON.

Ensure /health reports expected API key status.

3. Security Focus

Prompt injection defense: add regression test that malicious input (ignore previous instructions) does not alter system role.

CSP headers: validate correct Content-Security-Policy applied in demo build.

Input sanitization: ensure inputs clamp at 4â€“8k chars, strip control characters.

Secrets check: CI fails if .dev.vars or .env appear in git.

4. Performance

Frontend stress test:

Render 100+ messages â†’ ensure no jank, auto-scroll still smooth.

Streaming perf:

Simulate long OpenAI stream (~2k tokens) â†’ ensure buffer doesnâ€™t leak.

Memory test:

Confirm pending buffer flushes on done.

Startup latency:

Measure npm run dev to ready state under 5s baseline.

Deliverables

âœ… tests/ folder with unit + integration tests.

âœ… CI workflow extended (.github/workflows/ci.yml).

âœ… Documentation in devlog.md: QA scenarios, security checklist.

âœ… Performance metrics logged.

Acceptance Criteria

All tests green in CI and local.

Security scan shows 0 critical vulnerabilities.

Performance budget enforced.

Friendly UX preserved (graceful errors, auto-scroll, streaming buffer).